select 
    s.user_id,
    sum(s.RECOVER_ACCOUNT_CAPITAL_WAIT + s.RECOVER_ACCOUNT_INTEREST_WAIT) as WAIT

from (
SELECT
	A.USER_ID,
	SUM(
		CASE
		WHEN RECOVER_FULL_STATUS = 1
		AND RECOVER_ACCOUNT_CAPITAL_WAIT > 0 THEN
			0
		ELSE
			CASE
		WHEN TENDER_ACCOUNT_STATUS = 1 THEN
			A.RECOVER_ACCOUNT_CAPITAL_WAIT / 100
		ELSE
			0
		END
		END
	) AS RECOVER_ACCOUNT_CAPITAL_WAIT,
	SUM(
		CASE
		WHEN RECOVER_FULL_STATUS = 1
		AND RECOVER_ACCOUNT_INTEREST_WAIT > 0 THEN
			0
		ELSE
			CASE
		WHEN TENDER_ACCOUNT_STATUS = 1 THEN
			A.RECOVER_ACCOUNT_INTEREST_WAIT / 100
		ELSE
			0
		END
		END
	) AS RECOVER_ACCOUNT_INTEREST_WAIT
FROM
	mdtx_business.project_tender_detail A
LEFT JOIN mdtx_business.financial_plan_order_detail FC ON A.PROJECT_ID = FC.PROJECT_ID
LEFT JOIN mdtx_business.easy_aggregate_order_detail EA ON (A.PROJECT_ID = EA.PROJECT_ID)
WHERE
	FC.PROJECT_ID IS NULL
AND EA.PROJECT_ID IS NULL
AND A.user_id = '${userId}'
AND A.TENDER_ACCOUNT_STATUS IN (0, 1)
GROUP BY
	A.USER_ID

union ALL


SELECT
	A.USER_ID,
	SUM(
		CASE
		WHEN A.ORDER_STATUS <> 5 THEN
			IFNULL(A.TENDER_AMOUNT, 0) / 100
		ELSE
			0
		END
	) AS RECOVER_ACCOUNT_CAPITAL_WAIT,
	SUM(
		CASE
		WHEN A.ORDER_STATUS <> 5 THEN
			CASE
		WHEN 
			DATE_FORMAT(now(),'%Y-%m-%d') < DATE_FORMAT(INTEREST_TIME,'%Y-%m-%d') THEN
			0
		ELSE
			ROUND(
				(A.TENDER_AMOUNT / 100) * DATEDIFF(now(),interest_time) * (C.INCOME_RATE / 100) / 360,
				2
			)
		END
		ELSE
			0
		END
	) AS RECOVER_ACCOUNT_INTEREST_WAIT
FROM
	mdtx_business.financial_plan_order A
LEFT JOIN mdtx_business.financial_plan C ON A.FINANCIAL_PLAN_ID = C.ID
WHERE
	1 = 1
AND A.user_id = '${userId}'
GROUP BY
	A.USER_ID

union all
-- 省心投
SELECT
	EAO.USER_ID,
	SUM(
		S.RECOVER_ACCOUNT_CAPITAL_WAIT
	),
	SUM(
		S.RECOVER_ACCOUNT_INTEREST_WAIT
	)
FROM
	mdtx_business.easy_aggregate_order EAO
LEFT JOIN (
	SELECT
		AO.EASY_AGGREGATE_ORDER_ID,
		AO.USER_ID,
		SUM(
			CASE
			WHEN RECOVER_FULL_STATUS = 1
			AND RECOVER_ACCOUNT_CAPITAL_WAIT > 0 THEN
				0
			ELSE
				PD.RECOVER_ACCOUNT_CAPITAL_WAIT / 100
			END
		) RECOVER_ACCOUNT_CAPITAL_WAIT,
		SUM(
			CASE
			WHEN RECOVER_FULL_STATUS = 1
			AND RECOVER_ACCOUNT_INTEREST_WAIT > 0 THEN
				0
			ELSE
				PD.RECOVER_ACCOUNT_INTEREST_WAIT / 100
			END
		) RECOVER_ACCOUNT_INTEREST_WAIT
	FROM
		mdtx_business.easy_aggregate_order_detail AO
	LEFT JOIN mdtx_business.project_tender_detail PD ON (
		AO.PROJECT_ID = PD.PROJECT_ID
		AND AO.TENDER_DETAIL_ID = PD.ID
	)
	LEFT JOIN mdtx_business.creditor_purchase_order B ON PD.ID = B.RELATE_TENDER_DETAIL_ID
	GROUP BY
		AO.EASY_AGGREGATE_ORDER_ID,
		AO.USER_ID
) S ON (
	EAO.ID = S.EASY_AGGREGATE_ORDER_ID
	AND EAO.USER_ID = S.USER_ID
)
WHERE
	1 = 1
AND EAO.user_id = '${userId}'
GROUP BY
	EAO.USER_ID

) s